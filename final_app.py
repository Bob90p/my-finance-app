import streamlit as st
import yfinance as yf
import google.generativeai as genai

# ุถุน ููุชุงุญู ููุง (ุชุฃูุฏ ูู ุจูุงุก ุนูุงูุงุช ุงูุชูุตูุต)
genai.configure(api_key="ุถุน_ููุชุงุญู_ููุง")
model = genai.GenerativeModel('gemini-pro')

st.set_page_config(page_title="ุงููุญูู ุงูุงุณุชุฑุงุชูุฌู", layout="wide")
st.title("๐ ุงููุญูู ุงููุงูู ูุงูุณูุงุณู ุงูุนุงููู")

# --- ููุทูุฉ ุงูุฅุฏุฎุงู ---
col1, col2 = st.columns([1, 1])

with col1:
    st.subheader("๐ ุงูุจุญุซ ุนู ุฃุตู ูุงูู")
    # ููุง ููููู ูุชุงุจุฉ ุฃู ุฑูุฒ ุณูู ุนุงููู
    ticker = st.text_input("ุงูุชุจ ุฑูุฒ ุงูุณูู ุฃู ุงูุนููุฉ (ูุซุงู: AAPL ูุขุจูุ TSLA ูุชุณูุงุ GC=F ููุฐูุจ):", "AAPL")
    
with col2:
    st.subheader("๐ฌ ุณูุงู ุฅุถุงูู")
    context = st.text_area("ุฃุถู ุฃู ุฃุฎุจุงุฑ ุณูุงุณูุฉ ุชุฑูุฏ ุฑุจุทูุง ุจุงูุชุญููู (ุงุฎุชูุงุฑู):")

if st.button("ุจุฏุก ุงูุชุญููู ุงูุนููู ูุงูุดุงูู"):
    try:
        # 1. ุฌูุจ ุจูุงูุงุช ุงูุณูู/ุงูุฃุตู
        with st.spinner("ุฌุงุฑู ุณุญุจ ุงูุจูุงูุงุช ูู ุงูุฃุณูุงู ุงูุนุงูููุฉ..."):
            stock = yf.Ticker(ticker)
            info = stock.history(period="5d")
            current_price = info['Close'].iloc[-1]
            
            st.metric(label=f"ุงูุณุนุฑ ุงูุญุงูู ูู {ticker}", value=f"{current_price:.2f}")
            st.line_chart(info['Close'])

        # 2. ุงูุชุญููู ุจุงูุฐูุงุก ุงูุงุตุทูุงุนู
        with st.spinner("ุฐูุงุก Gemini ูุญูู ุงูุขู ุงููุดูุฏ ุงูุณูุงุณู ูุงูุงูุชุตุงุฏู..."):
            prompt = f"""
            ุจุตูุชู ุฎุจูุฑ ุฌููุณูุงุณู ููุญูู ูุงูู:
            ุงูุฃุตู: {ticker}
            ุงูุณุนุฑ ุงูุญุงูู: {current_price}
            ุงูุณูุงู ุงูุฅุถุงูู ูู ุงููุณุชุฎุฏู: {context}
            
            ุงููุทููุจ:
            1. ุชุญููู ุชุฃุซูุฑ ุฃูู ุงูุฃุฎุจุงุฑ ุงูุนุงูููุฉ ุงูุญุงููุฉ ุนูู ูุฐุง ุงูุฃุตู.
            2. ุชูููู ุงููุฎุงุทุฑ ุงูุณูุงุณูุฉ.
            3. ุชูุตูุฉ ุงุณุชุซูุงุฑูุฉ ูุงุถุญุฉ (ุดุฑุงุก/ุจูุน/ุงูุชุธุงุฑ) ูุน ุฐูุฑ ุงูุณุจุจ ุงูุนููู.
            """
            response = model.generate_content(prompt)
            st.markdown("---")
            st.subheader("๐ก ุงูุชูุตูุฉ ูุงูุชุญููู ุงูุนููู")
            st.write(response.text)
            
    except Exception as e:
        st.error(f"ุชุฃูุฏ ูู ูุชุงุจุฉ ุงูุฑูุฒ ุจุดูู ุตุญูุญ. ุฎุทุฃ: {e}")
